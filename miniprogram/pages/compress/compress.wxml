<!--compress.wxml-->
<view class="container">
  <view class="header">
    <text class="title">图片压缩</text>
  </view>
  
  <view class="image-container">
    <block wx:if="{{!imageUrl}}">
      <view class="image-placeholder" bindtap="chooseImage">
        <view class="placeholder-icon">+</view>
        <view class="placeholder-text">点击选择图片</view>
      </view>
    </block>
    <block wx:else>
      <image class="selected-image" src="{{imageUrl}}" mode="aspectFit" bindtap="chooseImage"></image>
      <view class="image-info">
        <text>原始大小: {{originalSize / 1024 | 0}} KB</text>
        <text wx:if="{{imageWidth > 0}}">尺寸: {{imageWidth}} x {{imageHeight}}</text>
      </view>
    </block>
  </view>
  
  <block wx:if="{{imageUrl}}">
    <view class="compress-options">
      <view class="slider-container">
        <text class="slider-label">压缩级别: {{compressLevel}}%</text>
        <slider min="10" max="90" value="{{compressLevel}}" activeColor="#3498db" backgroundColor="#e0e0e0" block-size="20" block-color="#ffffff" bindchange="changeCompressLevel" />
      </view>
      <button class="compress-button" bindtap="compressImage" loading="{{isCompressing}}">{{isCompressing ? '压缩中...' : '开始压缩'}}</button>
    </view>
  </block>
  
  <block wx:if="{{compressedImageUrl}}">
    <view class="result-container">
      <view class="result-title">压缩结果</view>
      <image class="compressed-image" src="{{compressedImageUrl}}" mode="aspectFit" bindtap="previewImage"></image>
      <view class="image-info">
        <text>压缩后大小: {{compressedSize / 1024 | 0}} KB</text>
        <text class="compression-rate">压缩率: {{compressionRate}}%</text>
      </view>
      <view class="button-group">
        <button class="save-button" bindtap="saveImage">保存到相册</button>
        <button class="preview-button" bindtap="previewImage">预览图片</button>
      </view>
    </view>
  </block>
  
  <!-- 用于压缩的Canvas，设置为不可见 -->
  <canvas canvas-id="compressCanvas" style="width: 0px; height: 0px; position: absolute; left: -9999px;"></canvas>
</view> 
<!--recognize.wxml-->
<view class="container">
  <!-- 页面标题 -->
  <view class="header">
    <text class="title">图像识别</text>
    <view class="api-quota">
      <progress percent="{{apiQuota.used / apiQuota.total * 100}}" stroke-width="3" activeColor="#07c160" backgroundColor="#e6e6e6" />
      <text class="quota-text">今日可用: {{apiQuota.total - apiQuota.used}}/{{apiQuota.total}}</text>
    </view>
  </view>

  <!-- 上传图片区域 -->
  <block wx:if="{{!image}}">
    <view class="upload-area" bindtap="chooseImage">
      <view class="upload-icon-placeholder">
        <text class="icon-text">+</text>
      </view>
      <text class="upload-text">点击上传或拍摄图片</text>
      <text class="upload-tip">支持多种图像类型识别</text>
    </view>
  </block>

  <!-- 图片预览区域 -->
  <block wx:if="{{image && !recognizeResult && !isLoading}}">
    <view class="image-preview-container">
      <image class="image-preview" src="{{image}}" mode="aspectFit"></image>
      
      <!-- 进度显示 -->
      <view class="progress-container" wx:if="{{uploadProgress > 0}}">
        <text class="progress-text">图片准备就绪</text>
        <progress percent="{{uploadProgress}}" active stroke-width="3" activeColor="#07c160" />
      </view>
      
      <!-- 自定义提示输入区 -->
      <view class="custom-prompt-container">
        <view class="prompt-header" bindtap="toggleCustomPrompt">
          <text>添加自定义提示</text>
          <view class="toggle-icon">{{showCustomPromptInput ? '▲' : '▼'}}</view>
        </view>
        
        <view class="prompt-input-area" wx:if="{{showCustomPromptInput}}">
          <input class="prompt-input" placeholder="输入提示信息以获得更精确的识别结果" value="{{customPrompt}}" bindinput="onCustomPromptInput" maxlength="100" />
          <text class="prompt-tip">例如：识别这张照片中的建筑物、翻译图片中的文字等</text>
        </view>
      </view>
      
      <!-- 操作按钮 -->
      <view class="action-buttons">
        <button class="action-btn secondary" bindtap="resetImage">重新选择</button>
        <button class="action-btn primary" bindtap="recognizeImage">开始识别</button>
      </view>
    </view>
  </block>

  <!-- 加载中状态 -->
  <block wx:if="{{isLoading}}">
    <view class="loading-container">
      <view class="loading-spinner"></view>
      <text class="loading-text">正在识别图片内容...</text>
      
      <!-- 进度条 -->
      <view class="progress-container">
        <progress percent="{{processingProgress}}" active stroke-width="3" activeColor="#07c160" />
        <text class="progress-percentage">{{processingProgress.toFixed(0)}}%</text>
      </view>
    </view>
  </block>

  <!-- 识别结果展示 -->
  <block wx:if="{{recognizeResult && !isLoading}}">
    <view class="result-container">
      <image class="result-image" src="{{image}}" mode="aspectFit"></image>
      
      <!-- 调整为只显示一个结果块 -->
      <view class="result-segments" wx:if="{{resultSections.length > 0}}">
        <view class="segment-item">
          <!-- 不再显示标题 -->
          <!-- <text class="segment-title">{{resultSections[0].title}}</text> -->
          <text class="segment-content">{{resultSections[0].content}}</text>
        </view>
      </view>
      
      <view class="action-buttons">
        <button class="action-btn secondary" bindtap="resetImage">重新识别</button>
        <button class="action-btn primary" open-type="share">分享结果</button>
      </view>
    </view>
  </block>
</view> 